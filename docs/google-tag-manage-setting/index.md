# Google Tag Manage Step



关于ga（Google analytics），简单说两句。

第1句：ga是目前世界上最好用的免费web数据收集分析软件。

第2句：ga在国内使用暂且没有因为网络限制导致的数据不准，工作后台操作不便倒是有。

截止2018年年底，常见的部署ga代码的方法有叁：

ga后台获取ga代码以后，直接加到网站的<head>标签里。（简单直接，扩展性差）
ga后台获取ga代码后，在Google tag manager后台添加html代码。
（这个方法特别适合运营人员，因为它可以省略之后因为修改这个ga代码，或者增加ga代码的配置，去依赖程序员。但是它对运营人员的代码基础和正则表达式的了解基础是有要求的。）

3.较为推荐：ga后台获取ga代码后，在Google tag manager后台，利用gtm专有的套件为ga添加代码。之后调整ga代码也是靠它。

（这个方法与易用性还是体验上以及将来的综合扩展，都是最佳的。）

那我天介绍的方法就是这个方法。下图是这个方法的部署步骤：


Ga大家都了解了，就是谷歌分析，什么是gtm呢，全称叫Google tag manager，它相当于是一个iframe，你把这个iframe容器添加到网站里，容器内的任何代码由你在gui可视化后台随意控制，不需要劳烦程序员。扩展阅读见：什么是Google Tag Manager



上图注解：

在gtm中新建一个容器类型，选择web，填好你的域名；
在gtm的跟踪代码添加到你的head中和body中。也可以全部添加到head中，注意这里添加到网站的是gtm代码，ga代码在这个方法中不需要添加到网站的；
在ga里边新建媒体资源，填写网站名称，域名行业类别：创建网站。从跟踪代码中获取跟踪id；
在gtm中新建tag，选择通用ga部署；（操作三步骤，见下图：）

第一步，新建tag

第二步新建变量

这是部署完成后的样子
5.在gtm中设置forceSSL为ture、SiteSpeedSamplerate参数为100、samplerate参数为100；这个操作是在变量编辑中完成的，下文中的注解会注明这三个参数设置的好处。


6.在ga广告中设置中打开广告报告功能，这样受众和兴趣报告可以看到，然后保存，gtm这边把代码发布。

7.ga配置:在数据视图层级下面指定默认页为index.html（这样可以合并/和/index.html的流量）

8.ga配置：数据视图下，勾选排除来自自己的蜘蛛程序的所有匹配（提升流量的精准度。）


9.ga配置：在ga后台中新建过滤器过滤掉自身流量，比如我的域名是：https://ibolee.com，那我就新建一个过滤器，然后点选主机过滤，过滤https://ibolee.com，这样最后得到的流量就没有自身流量。

10.在用户管理跟踪代码中测试ga流量。



如果你对我上述说的10个流程没有概念，比较模糊，可以下述链接的这个视频的第34:43秒开始处中有完整演示：Google Analytics部署与参数调优，Ga小站视频



下面介绍一下ga和gtm配置中出现的几个参数的作用：



1.gtm配置：forcessl



如果说你的一个网站不是https，是HTTP的，他跳转到现在的ga服务器的话，他所有的服务器都已经升级到https的，如果说你的是HTTP的话，你发过去的数据会自动的做了一个跳转。需要在你发出之前的话，先对它（被发送的数据）做一个强制的转换，所以说要配置这个。

2.gtm配置：sitespeedsamplerate（网站速度抽样率）



官方的解释是：此设置决定以何种频率发送网站速度跟踪信标。设置参数为100以后，频率降到最低，加载时间会大大的一个降低。



3.gtm配置：samplerate（抽样率）



Google Analytics有个网站速度的报告，可以看到每一个网页从点击链接到浏览器上完全展示的时间，在GA默认情况下，Google Analytics会固定抽取访客1%作为计算网站速度的样本，如果你的网站的整体流量比较少，那么这1%的抽样的影响就非常大了，在这种情况下，就需要修改GA的默认抽样比例。修改samplerate参数。

4.gtm开启广告功能



gtm设置在你的设变量代码设置里下拉，有一个启用展示广告功能，把这个功能勾选保存发布即可。无论是ga还是gtm，这两个功能都是需要开启的。者关系到你可以细分媒介流量来源报告。



5.ga设置：ga过滤出自身流量



ga过滤出自身的流量，有时候有些爬虫或者垃圾流量它会发送其他一些其他站点的一些垃圾数据到你这个这个媒体资源里面，所以要把你自身的一些数据给过滤出来。这个的设置在ga后台的过滤器自定义里边，把自己的域名输入即可。



6.ga设置：去除机器和爬虫流量

爬虫流量有时候会有一些机器的爬虫访问你的站点，导致会有一些流量的一些异常，这个的设置比较简单，在ga后台的个人数据视图下边勾选：排除来自已知漫游器和蜘蛛程序的所有匹配，即可。

7.ga设置：移除机器查询参数

比如说你在做邮件营销的时候，然后用户通过你那个邮件进来的那个主页，有可能会有一个变量，一个高维度指标。

比如邮件营销流量http://ichdata.com/ssid=88888888，这个ssid就可以过滤掉。
这个参数就可以把它移除掉，把这个ssid放到ga后台的数据视图设置里边有一个输入框，叫排除网址查询参数里边填入即可。

8.ga设置：主页数据合并

在这些后台的数据视图设置里面，有一个默认页输入框，在输入框中设置index点html。这样的设置，它可以合并斜杠和你这个html的首页的流量。

9.ga和gtm设置：广告报告功能

在ga媒体资源设置的跟踪信息下边，有一个数据收集，数据收集里边有一个广告报告功能，这个功能需要启用，为什么要启用呢？当你启用了它的功能以后，你就可以收集到受众群体的受众特征和兴趣，报告这个数据。但是如果没有开启的话，这两块数据就得不到。

10.ga设置：再营销功能

特别需要注意的一点是，广告报告功能上边有一个再营销功能，这个功能不要打开，因为这个功能请求的url是被我们国家屏蔽的，如果你在国内做数据分析类的工作的话，是不需要打开这个的。

11.ga设置：在报告中启用用户指标

这个功能打开以后，会让报告中的用户数据更加的精准，它是利用谷歌的一种用户计算方式。

流量测试方法

1.test traffic



这个功能是在媒体资源设置里边的跟踪信息下边有一个跟踪代码，跟踪ID下面有一个状态，这个状态发送测试流量即可发送流量，发送完流量之后到实时--概览去查看。



2.tag assistant

这个软件是谷歌浏览器里边的一个插件，需要我们在使用的时候先安装它。然后在装有ga代码的网站上进行重新家在，它会像fire fox的firebug一样显示测试结果内容。

